# Orders

> Orders are represented as follows:

```json
{
  "id": "9999999",
  "provider": "shopify",
  "upstream_id": "abcdef",
  "identifier": "Order_123456",
  "amount": 4900,
  "tax": 100,
  "fees": 0,
  "discount": 0,
  "permalink": "http://myorders.com/orders/123456",
  "currency_code": "USD",
  "properties": {
    "size": "medium",
    "color": "red"
  },
  "occurred_at": 2013-06-21T10:31:58Z,
  "closed_at": 2013-06-21T10:35:58Z,
  "cancelled_at": nil,
  "financial_state": "paid",
  "fulfillment_state": "fulfilled",
  "billing_address": {
    "name": "Bill Billington",
    "first_name": "Bill",
    "last_name": "Billington",
    "company": "Bills R US",
    "address_1": "123 Bill St.",
    "address_2": "Apt. B",
    "city": "Billtown",
    "state": "CA",
    "zip": "01234",
    "country": "United States",
    "phone": "555-555-5555",
    "email": "bill@bills.com"
  },
  "shipping_address": {
    "name": "Ship Shippington",
    "first_name": "Ship",
    "last_name": "Shipington",
    "company": "Shipping 4 Less",
    "address_1": "123 Ship St.",
    "address_2": "null",
    "city": "Shipville",
    "state": "CA",
    "zip": "01234",
    "country": "United States",
    "phone": "555-555-5555",
    "email": "ship@shipping.com"
  },
  "items": [{
    "id": "8888888",
    "product_id": "765432",
    "sku": "4444",
    "amount": 4900,
    "name": "Canoe",
    "quantity": 1,
    "upstream_id": "hijkl",
    "upstream_product_id": "opqrs",
    "upstream_product_variant_id": "zyxwv",
    "price": 4900,
    "tax": 100,
    "fees": 0,
    "discount": 100,
    "taxable": true,
    "properties": {
      "color": "black"
    }
  }],
  "links": {
    "account": "9999999",
    "subscriber": "5555555"
  }
}
```

**Properties**

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>A read-only Drip generated unique id used to identify each order record.</td>
    </tr>
    <tr>
      <td><code>provider</code></td>
      <td>The identifier for the provider from which the order data was received in lower snake cased form. For example, <code>shopify</code> or <code>my_store</code></td>
    </tr>
    <tr>
      <td><code>amount</code></td>
      <td>The total amount of the order in cents (e.g. if the order was $49.99, set the amount to <code>4999</code>).</td>
    </tr>
    <tr>
      <td><code>tax</code></td>
      <td>The tax on the order in cents (e.g. if the order was $1.00, set the tax to <code>100</code>).</td>
    </tr>
    <tr>
      <td><code>fees</code></td>
      <td>The fees on the order in cents (e.g. if the order was $1.00, set the fees to <code>100</code>).</td>
    </tr>
    <tr>
      <td><code>discount</code></td>
      <td>The discount on the order in cents (e.g. if the order was $5.00, set the discount to <code>500</code>).</td>
    </tr>
    <tr>
      <td><code>permalink</code></td>
      <td>A URL for the human-readable interface to view the order details.</td>
    </tr>
    <tr>
      <td><code>currency_code</code></td>
      <td>The alphabetic <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> code for the currency of the purchase.</td>
    </tr>
    <tr>
      <td><code>upstream_id</code></td>
      <td>A unique id for the order (generally the primary key generated by the order management system).</td>
    </tr>
    <tr>
      <td><code>identifier</code></td>
      <td>A unique identifier for the order.</td>
    </tr>
    <tr>
      <td><code>properties</code></td>
      <td>An Object containing properties about the order. E.g. <code>{ "size": "large" }</code></td>
    </tr>
    <tr>
      <td><code>occurred_at</code></td>
      <td>The String time at which the order occurred in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format. Defaults to the current time.</td>
    </tr>
    <tr>
      <td><code>closed_at</code></td>
      <td>The String time at which the order closed in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format.</td>
    </tr>
    <tr>
      <td><code>cancelled_at</code></td>
      <td>The String time at which the order was cancelled in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format. For an order that was not cancelled, this will be <code>nil</code>.</td>
    </tr>
    <tr>
      <td><code>financial_state</code></td>
      <td>The financial status of the order. One of the following values: <code>pending</code>, <code>authorized</code>, <code>partially_paid</code>, <code>paid</code>, <code>partially_refunded</code>, <code>refunded</code>, <code>voided</code>.</td>
    </tr>
      <td><code>fulfillment_state</code></td>
      <td>The fulfillment status of the order. One of the following values: <code>not_fulfilled</code>, <code>partially_fulfilled</code>, <code>fulfilled</code>.</td>
    </tr>
    <tr>
      <td><code>billing_address</code></td>
      <td>
        An object containing billing address information.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The full name on the billing address</td>
            </tr>
            <tr>
              <td><code>first_name</code></td>
              <td>The first name on the billing address</td>
            </tr>
            <tr>
              <td><code>last_name</code></td>
              <td>The last name on the billing address</td>
            </tr>
            <tr>
              <td><code>company</code></td>
              <td>The company on the billing address</td>
            </tr>
            <tr>
              <td><code>address_1</code></td>
              <td>The billing street address</td>
            </tr>
            <tr>
              <td><code>address_2</code></td>
              <td>Additional line of the billing street address</td>
            </tr>
            <tr>
              <td><code>city</code></td>
              <td>The billing address city</td>
            </tr>
            <tr>
              <td><code>state</code></td>
              <td>The billing address state</td>
            </tr>
            <tr>
              <td><code>zip</code></td>
              <td>The billing address zip code</td>
            </tr>
            <tr>
              <td><code>country</code></td>
              <td>The billing address country</td>
            </tr>
            <tr>
              <td><code>phone</code></td>
              <td>The phone number associated with the billing address</td>
            </tr>
            <tr>
              <td><code>email</code></td>
              <td>The email associated with the billing address</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>shipping_address</code></td>
      <td>
        An object containing shipping address information.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The full name on the shipping address</td>
            </tr>
            <tr>
              <td><code>first_name</code></td>
              <td>The first name on the shipping address</td>
            </tr>
            <tr>
              <td><code>last_name</code></td>
              <td>The last name on the shipping address</td>
            </tr>
            <tr>
              <td><code>company</code></td>
              <td>The company on the shipping address</td>
            </tr>
            <tr>
              <td><code>address_1</code></td>
              <td>The shipping street address</td>
            </tr>
            <tr>
              <td><code>address_2</code></td>
              <td>Additional line of the shipping street address</td>
            </tr>
            <tr>
              <td><code>city</code></td>
              <td>The shipping address city</td>
            </tr>
            <tr>
              <td><code>state</code></td>
              <td>The shipping address state</td>
            </tr>
            <tr>
              <td><code>zip</code></td>
              <td>The shipping address zip code</td>
            </tr>
            <tr>
              <td><code>country</code></td>
              <td>The shipping address country</td>
            </tr>
            <tr>
              <td><code>phone</code></td>
              <td>The phone number associated with the shipping address</td>
            </tr>
            <tr>
              <td><code>email</code></td>
              <td>The email associated with the shipping address</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>items</code></td>
      <td>
        An Array of objects containing information about specific order items.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The product name</td>
            </tr>
            <tr>
              <td><code>amount</code></td>
              <td>The line total (in cents).</td>
            </tr>
            <tr>
              <td><code>price</code></td>
              <td>The item price (in cents).</td>
            </tr>
            <tr>
              <td><code>tax</code></td>
              <td>The item tax (in cents).</td>
            </tr>
            <tr>
              <td><code>fees</code></td>
              <td>The item fees (in cents).</td>
            </tr>
            <tr>
              <td><code>discount</code></td>
              <td>The item discount (in cents).</td>
            </tr>
            <tr>
              <td><code>quantity</code></td>
              <td>The quantity of the item ordered (if omitted, defaults to 1).</td>
            </tr>
            <tr>
              <td><code>product_id</code></td>
              <td>A unique identifier for the specific product.</td>
            </tr>
            <tr>
              <td><code>upstream_id</code></td>
              <td>A unique identifier for the item from the provider.</td>
            </tr>
            <tr>
              <td><code>upstream_product_id</code></td>
              <td>A unique identifier for the specific product from the provider.</td>
            </tr>
            <tr>
              <td><code>upstream_product_variant_id</code></td>
              <td>A unique identifier for the specific product variant from the provider.</td>
            </tr>
            <tr>
              <td><code>sku</code></td>
              <td>The product SKU number.</td>
            </tr>
            <tr>
              <td><code>taxable</code></td>
              <td>Boolean indicating whether the item is taxable.</td>
            </tr>
            <tr>
              <td><code>properties</code></td>
              <td>An Object containing properties about the line item.</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>links</code></td>
      <td>An object containing the REST API URL for the account.</td>
    </tr>
  </tbody>
</table>

## Create or update an order

> To create or update an order for a subscriber:

```shell
curl -X POST "https://api.getdrip.com/v2/YOUR_ACCOUNT_ID/orders" \
  -H 'User-Agent: Your App Name (www.yourapp.com)' \
  -u YOUR_API_KEY: \
  -d @- << EOF
  {
    "orders": [{
      "email": "john@acme.com",
      "provider": "shopify",
      "upstream_id": "abcdef",
      "identifier": "Order_123456",
      "amount": 4900,
      "tax": 100,
      "fees": 0,
      "discount": 0,
      "permalink": "http://myorders.com/orders/123456",
      "currency_code": "USD",
      "properties": {
        "size": "medium",
        "color": "red"
      },
      "occurred_at": "2013-06-21T10:31:58Z",
      "closed_at": "2013-06-21T10:35:58Z",
      "financial_state": "paid",
      "fulfillment_state": "fulfilled",
      "billing_address": {
        "name": "Bill Billington",
        "first_name": "Bill",
        "last_name": "Billington",
        "company": "Bills R US",
        "address_1": "123 Bill St.",
        "address_2": "Apt. B",
        "city": "Billtown",
        "state": "CA",
        "zip": "01234",
        "country": "United States",
        "phone": "555-555-5555",
        "email": "bill@bills.com"
      },
      "shipping_address": {
        "name": "Ship Shippington",
        "first_name": "Ship",
        "last_name": "Shipington",
        "company": "Shipping 4 Less",
        "address_1": "123 Ship St.",
        "address_2": "null",
        "city": "Shipville",
        "state": "CA",
        "zip": "01234",
        "country": "United States",
        "phone": "555-555-5555",
        "email": "ship@shipping.com"
      },
      "items": [{
          "id": "8888888",
          "product_id": "765432",
          "sku": "4444",
          "amount": 4900,
          "name": "Canoe",
          "quantity": 1,
          "upstream_id": "hijkl",
          "upstream_product_id": "opqrs",
          "upstream_product_variant_id": "zyxwv",
          "price": 4900,
          "tax": 100,
          "fees": 0,
          "discount": 100,
          "taxable": true,
          "properties": {
            "color": "black"
          }
        }]
    }]
  }
  EOF
```


> Responds with a `202 Accepted` and an empty JSON response:

```json
{}
```

When an order is created, the subscriber's `lifetime_value` attribute
will be automatically incremented by the total amount of the order.

To update an existing order, include the <code>provider</code> and <code>upstream_id</code> for that order in the payload.

**Note**: A matching subscriber record must already be present in Drip before an order can be created.

### HTTP Endpoint

`POST /:account_id/orders`

### Arguments

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>email</code></td>
      <td>Optional. The email address of the order's subscriber. Either <code>email</code> or <code>id</code> must be included.</td>
    </tr>
    <tr>
      <td><code>id</code></td>
      <td>Optional. The Drip <code>id</code> of the order's subscriber. Either <code>email</code> or <code>id</code> must be included.</td>
    </tr>
    <tr>
      <td><code>amount</code></td>
      <td>Required. The total amount of the order in cents (e.g. if the order was $49.99, set the amount to <code>4999</code>).</td>
    </tr>
    <tr>
      <td><code>provider</code></td>
      <td>Optional. The identifier for the provider from which the order data was received in lower snake cased form. For example, <code>shopify</code> or <code>my_store</code>. Used to identify the order for updates.</td>
    </tr>
    <tr>
      <td><code>tax</code></td>
      <td>Optional. The tax on the order in cents (e.g. if the order was $1.00, set the tax to <code>100</code>).</td>
    </tr>
    <tr>
      <td><code>fees</code></td>
      <td>Optional. The fees on the order in cents (e.g. if the order was $1.00, set the fees to <code>100</code>).</td>
    </tr>
    <tr>
      <td><code>discount</code></td>
      <td>Optional. The discount on the order in cents (e.g. if the order was $5.00, set the discount to <code>500</code>).</td>
    </tr>
    <tr>
      <td><code>permalink</code></td>
      <td>Optional. A URL for the human-readable interface to view the order details.</td>
    </tr>
    <tr>
      <td><code>currency_code</code></td>
      <td>Optional. The alphabetic <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> code for the currency of the purchase.</td>
    </tr>
    <tr>
      <td><code>upstream_id</code></td>
      <td>Optional. A unique id for the order (generally the primary key generated by the order management system).
      Used to identify the order for updates.</td>
    </tr>
    <tr>
      <td><code>identifier</code></td>
      <td>Optional. A unique identifier for the order.</td>
    </tr>
    <tr>
      <td><code>properties</code></td>
      <td>Optional. An Object containing properties about the order. E.g. <code>{ "size": "large" }</code></td>
    </tr>
    <tr>
      <td><code>occurred_at</code></td>
      <td>Optional. The String time at which the order occurred in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format. Defaults to the current time.</td>
    </tr>
    <tr>
      <td><code>closed_at</code></td>
      <td>Optional. The String time at which the order closed in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format.</td>
    </tr>
    <tr>
      <td><code>cancelled_at</code></td>
      <td>Optional. The String time at which the order was cancelled in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format. For an order that was not cancelled, this will be <code>nil</code>.</td>
    </tr>
    <tr>
      <td><code>financial_state</code></td>
      <td>Optional. The financial status of the order. One of the following values: <code>pending</code>, <code>authorized</code>, <code>partially_paid</code>, <code>paid</code>, <code>partially_refunded</code>, <code>refunded</code>, <code>voided</code>.</td>
    </tr>
      <td><code>fulfillment_state</code></td>
      <td>Optional. The fulfillment status of the order. One of the following values: <code>not_fulfilled</code>, <code>partially_fulfilled</code>, <code>fulfilled</code>.</td>
    </tr>
    <tr>
      <td><code>billing_address</code></td>
      <td>
        Optional. An object containing billing address information.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The full name on the billing address</td>
            </tr>
            <tr>
              <td><code>first_name</code></td>
              <td>The first name on the billing address</td>
            </tr>
            <tr>
              <td><code>last_name</code></td>
              <td>The last name on the billing address</td>
            </tr>
            <tr>
              <td><code>company</code></td>
              <td>The company on the billing address</td>
            </tr>
            <tr>
              <td><code>address_1</code></td>
              <td>The billing street address</td>
            </tr>
            <tr>
              <td><code>address_2</code></td>
              <td>Additional line of the billing street address</td>
            </tr>
            <tr>
              <td><code>city</code></td>
              <td>The billing address city</td>
            </tr>
            <tr>
              <td><code>state</code></td>
              <td>The billing address state</td>
            </tr>
            <tr>
              <td><code>zip</code></td>
              <td>The billing address zip code</td>
            </tr>
            <tr>
              <td><code>country</code></td>
              <td>The billing address country</td>
            </tr>
            <tr>
              <td><code>phone</code></td>
              <td>The phone number associated with the billing address</td>
            </tr>
            <tr>
              <td><code>email</code></td>
              <td>The email associated with the billing address</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>shipping_address</code></td>
      <td>
        Optional. An object containing shipping address information.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The full name on the shipping address</td>
            </tr>
            <tr>
              <td><code>first_name</code></td>
              <td>The first name on the shipping address</td>
            </tr>
            <tr>
              <td><code>last_name</code></td>
              <td>The last name on the shipping address</td>
            </tr>
            <tr>
              <td><code>company</code></td>
              <td>The company on the shipping address</td>
            </tr>
            <tr>
              <td><code>address_1</code></td>
              <td>The shipping street address</td>
            </tr>
            <tr>
              <td><code>address_2</code></td>
              <td>Additional line of the shipping street address</td>
            </tr>
            <tr>
              <td><code>city</code></td>
              <td>The shipping address city</td>
            </tr>
            <tr>
              <td><code>state</code></td>
              <td>The shipping address state</td>
            </tr>
            <tr>
              <td><code>zip</code></td>
              <td>The shipping address zip code</td>
            </tr>
            <tr>
              <td><code>country</code></td>
              <td>The shipping address country</td>
            </tr>
            <tr>
              <td><code>phone</code></td>
              <td>The phone number associated with the shipping address</td>
            </tr>
            <tr>
              <td><code>email</code></td>
              <td>The email associated with the shipping address</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>items</code></td>
      <td>
        Optional. An Array of objects containing information about specific order items.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The product name</td>
            </tr>
            <tr>
              <td><code>amount</code></td>
              <td>The line total (in cents).</td>
            </tr>
            <tr>
              <td><code>price</code></td>
              <td>The item price (in cents).</td>
            </tr>
            <tr>
              <td><code>tax</code></td>
              <td>The item tax (in cents).</td>
            </tr>
            <tr>
              <td><code>fees</code></td>
              <td>The item fees (in cents).</td>
            </tr>
            <tr>
              <td><code>discount</code></td>
              <td>The item discount (in cents).</td>
            </tr>
            <tr>
              <td><code>quantity</code></td>
              <td>The quantity of the item ordered (if omitted, defaults to 1).</td>
            </tr>
            <tr>
              <td><code>product_id</code></td>
              <td>A unique identifier for the specific product.</td>
            </tr>
            <tr>
              <td><code>upstream_id</code></td>
              <td>A unique identifier for the item from the provider.</td>
            </tr>
            <tr>
              <td><code>upstream_product_id</code></td>
              <td>A unique identifier for the specific product from the provider.</td>
            </tr>
            <tr>
              <td><code>upstream_product_variant_id</code></td>
              <td>A unique identifier for the specific product variant from the provider.</td>
            </tr>
            <tr>
              <td><code>sku</code></td>
              <td>The product SKU number.</td>
            </tr>
            <tr>
              <td><code>taxable</code></td>
              <td>Boolean indicating whether the item is taxable.</td>
            </tr>
            <tr>
              <td><code>properties</code></td>
              <td>An Object containing properties about the line item.</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
  </tbody>
</table>

## Create or update a refund

> To create or update a refund for an order:

```shell
curl -X POST "https://api.getdrip.com/v2/YOUR_ACCOUNT_ID/refunds" \
  -H 'User-Agent: Your App Name (www.yourapp.com)' \
  -u YOUR_API_KEY: \
  -d @- << EOF
  {
    "refunds": [{
        "provider": "shopify",
        "order_upstream_id": "abcdef"
        "upstream_id": "tuvwx",
        "amount": 2000,
        "note": "Incorrect size",
        "processed_at": "2013-06-22T10:41:11Z"
      }]
  }
  EOF
```


> Responds with a `202 Accepted` and an empty JSON response:

```json
{}
```

When a refund is created, the subscriber's `lifetime_value` attribute
will be automatically decremented by the total amount of the refund.

To update an existing refund, include the <code>upstream_id</code> for that refund in the payload.

### HTTP Endpoint

`POST /:account_id/refunds`

### Arguments

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>provider</code></td>
      <td>Required. The provider for the Order being refunded.</td>
    </tr>
    <tr>
      <td><code>order_upstream_id</code></td>
      <td>Required. The <code>upstream_id</code> for the Order being refunded.</td>
    </tr>
    <tr>
      <td><code>amount</code></td>
      <td>Required. The amount of the refund.</td>
    </tr>
    <tr>
      <td><code>upstream_id</code></td>
      <td>Optional. The unique id of refund in the order management system. Used to identify the refund for updates.</td>
    </tr>
    <tr>
      <td><code>note</code></td>
      <td>Optional. A note about the refund.</td>
    </tr>
    <tr>
      <td><code>processed_at</code></td>
      <td>Optional. The String time at which the refund was processed in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format.</td>
    </tr>
  </tbody>
</table>

## Order events

Drip automatically records a number of events in the life cycle of an order. You can find
triggers for these events by selecting <code>Drip Order API</code> from the provider dropdown in your Drip automation.

<table>
  <thead>
    <tr>
      <th>Event</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Placed an order</code></td>
      <td>This event is fired when an order is created.</td>
    </tr>
    <tr>
      <td><code>Updated an order</code></td>
      <td>This event is fired when an existing order is updated.</td>
    </tr>
    <tr>
      <td><code>Paid an order</code></td>
      <td>This event is fired when the <code>financial_state</code> on an order is set to <code>paid</code>.</td>
    </tr>
    <tr>
      <td><code>Fulfilled an order</code></td>
      <td>This event is fired when the <code>fulfillment_state</code> on an order is set to <code>fulfilled</code>.</td>
    </tr>
    <tr>
      <td><code>Canceled an order</code></td>
      <td>This event is fired when the <code>cancelled_at</code> time on an order is set.</td>
    </tr>
    <tr>
      <td><code>Refunded an order</code></td>
      <td>This event is fired when a refund is created for an order.</td>
    </tr>
  </tbody>
</table>
