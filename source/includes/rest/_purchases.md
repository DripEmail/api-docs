# Purchases (Beta)

> Purchases are represented as follows:

```json
{
  "id": "9999999",
  "provider": "gumroad",
  "order_id": "123456",
  "amount": 4900,
  "permalink": "http://myorders.com/orders/123456",
  "properties": {
    "address": "123 Anywhere St"
  },
  "occurred_at": "2013-06-21T10:31:58Z",
  "items": [
    {
      "id": "8888888",
      "product_id": "765432",
      "sku": "4444",
      "amount": 4900,
      "name": "Canoe",
      "quantity": 1,
      "properties": {
        "color": "black"
      }
    }
  ],
  "links": {
    "account": "9999999",
    "subscriber": "98asdh9f8asd88d"
  }
}
```

> All responses containing purchase data also include the following top-level link data:

```json
{
  "links": {
    "purchases.account": "https://api.drip.com/v2/accounts/{purchases.account}",
    "purchases.subscriber": "https://api.drip.com/v2/subscribers/{purchases.subscriber}"
  }
}
```

**Properties**

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>A read-only Drip generated unique id used to identify each purchase record.</td>
    </tr>
    <tr>
      <td><code>provider</code></td>
      <td>The identifier for the provider from which the purchase data was received in lower snake cased form. For example, <code>shopify</code> or <code>my_store</code></td>
    </tr>
    <tr>
      <td><code>order_id</code></td>
      <td>A unique identifier for the order (generally the primary key generated by the order management system).</td>
    </tr>
    <tr>
      <td><code>amount</code></td>
      <td>The total amount of the purchase in cents (e.g. if the order was $49.99, set the amount to <code>4999</code>).</td>
    </tr>
    <tr>
      <td><code>permalink</code></td>
      <td>A URL for the human-readable interface to view the order details.</td>
    </tr>
    <tr>
      <td><code>properties</code></td>
      <td>An Object containing properties about the order. E.g. <code>{ "address": "123 Anywhere St" }</code></td>
    </tr>
    <tr>
      <td><code>occurred_at</code></td>
      <td>The String time at which the event occurred in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format. Defaults to the current time.</td>
    </tr>
    <tr>
      <td><code>items</code></td>
      <td>
        An Array of objects containing information about specific order items.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>The product name</td>
            </tr>
            <tr>
              <td><code>amount</code></td>
              <td>The line total (in cents).</td>
            </tr>
            <tr>
              <td><code>quantity</code></td>
              <td>The quantity of the item purchased (if omitted, defaults to 1).</td>
            </tr>
            <tr>
              <td><code>product_id</code></td>
              <td>A unique identifier for the specific product.</td>
            </tr>
            <tr>
              <td><code>sku</code></td>
              <td>The product SKU number.</td>
            </tr>
            <tr>
              <td><code>properties</code></td>
              <td>An Object containing properties about the line item.</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>links</code></td>
      <td>An object containing the REST API URL for the account.</td>
    </tr>
  </tbody>
</table>

## Create a purchase

> To create a purchase for a subscriber:

```shell
curl -X POST "https://api.drip.com/v2/YOUR_ACCOUNT_ID/subscribers/ID_OR_EMAIL/purchases" \
  -H 'User-Agent: Your App Name (www.yourapp.com)' \
  -u YOUR_API_KEY: \
  -d @- << EOF
  {
    "purchases": [{
      "provider": "gumroad",
      "order_id": "123456",
      "amount": 4900,
      "permalink": "http://myorders.com/orders/123456",
      "properties": {
        "address": "123 Anywhere St"
      },
      "occurred_at": "2013-06-21T10:31:58Z",
      "items": [
        {
          "id": "8888888",
          "product_id": "765432",
          "sku": "4444",
          "amount": 4900,
          "name": "Canoe",
          "quantity": 1,
          "properties": {
            "color": "black"
          }
        }
      ]
    }]
  }
  EOF
```

```ruby
require 'drip'

client = Drip::Client.new do |c|
  c.api_key = "YOUR API KEY"
  c.account_id = "YOUR_ACCOUNT_ID"
end

subscriber_email = "someone@example.com"
amount = 149000
options = {
  properties: {
    "address": "123 Anywhere St"
  },
  items: [
    {
      id: "8888888",
      product_id: "765432",
      sku: "4444",
      amount: 4900,
      name: "Canoe",
      quantity: 1,
      properties: {
        color: "black"
      }
    }
  ],
  occurred_at: "2013-06-21T10:31:58Z"
}
response = client.create_purchase(subscriber_email, amount, options)

if response.success?
  # ...
end
```

> Responds with a `201 Created` and an empty JSON response:

```json
{}
```

When a purchase is created, the subscriber's `lifetime_value` attribute
will be automatically incremented by the total amount of the purchase.

### HTTP Endpoint

`POST /:account_id/subscribers/:id_or_email/purchases`

### Arguments

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>amount</code></td>
      <td>Required. The total amount of the purchase in cents (e.g. if the order was $49.99, set the amount to <code>4999</code>).</td>
    </tr>
    <tr>
      <td><code>provider</code></td>
      <td>Optional. The identifier for the provider from which the purchase data was received (e.g. <code>gumroad</code>).</td>
    </tr>
    <tr>
      <td><code>order_id</code></td>
      <td>Optional. A unique identifier for the order (generally the primary key generated by the order management system).</td>
    </tr>
    <tr>
      <td><code>permalink</code></td>
      <td>Optional. A URL for the human-readable interface to view the order details.</td>
    </tr>
    <tr>
      <td><code>properties</code></td>
      <td>Optional. An Object containing properties about the order. E.g. <code>{ "address": "123 Anywhere St" }</code></td>
    </tr>
    <tr>
      <td><code>items</code></td>
      <td>
        Optional. An Array of objects containing information about specific order items.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>name</code></td>
              <td>Required. The product name</td>
            </tr>
            <tr>
              <td><code>amount</code></td>
              <td>Required. The line total (in cents).</td>
            </tr>
            <tr>
              <td><code>quantity</code></td>
              <td>Optional. The quantity of the item purchased (if omitted, defaults to 1).</td>
            </tr>
            <tr>
              <td><code>product_id</code></td>
              <td>Optional. A unique identifier for the specific product.</td>
            </tr>
            <tr>
              <td><code>sku</code></td>
              <td>Optional. The product SKU number.</td>
            </tr>
            <tr>
              <td><code>properties</code></td>
              <td>Optional. An Object containing properties about the line item.</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
    <tr>
      <td><code>occurred_at</code></td>
      <td>Optional. The String time at which the event occurred in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO-8601</a> format. Defaults to the current time.</td>
    </tr>
  </tbody>
</table>

## List purchases for a subscriber

> To list all purchases:

```shell
curl "https://api.drip.com/v2/YOUR_ACCOUNT_ID/subscribers/ID_OR_EMAIL/purchases" \
  -H 'User-Agent: Your App Name (www.yourapp.com)' \
  -u YOUR_API_KEY:
```

```ruby
require 'drip'

client = Drip::Client.new do |c|
  c.api_key = "YOUR API KEY"
  c.account_id = "YOUR_ACCOUNT_ID"
end

subscriber_email = "someone@example.com"
response = client.purchases(subscriber_email)

if response.success?
  puts response.body["purchases"]
end
```

> The response looks like this:

```json
# The purchases property is an array of purchase objects.
{
  "links": { ... },
  "meta": {
    "page": 1,
    "count": 5,
    "total_pages": 1,
    "total_count": 5
  },
  "purchases": [{ ... }]
}
```

### HTTP Endpoint

`GET /:account_id/subscribers/:id_or_email/purchases`

### Arguments

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>page</code></td>
      <td>Optional. The page number to retrieve. Defaults to 1.</td>
    </tr>
  </tbody>
</table>

## Fetch a purchase

> To fetch a specific purchase:

```shell
curl "https://api.drip.com/v2/YOUR_ACCOUNT_ID/subscribers/ID_OR_EMAIL/purchases/PURCHASE_ID" \
  -H 'User-Agent: Your App Name (www.yourapp.com)' \
  -u YOUR_API_KEY:
```

```ruby
require 'drip'

client = Drip::Client.new do |c|
  c.api_key = "YOUR API KEY"
  c.account_id = "YOUR_ACCOUNT_ID"
end

subscriber_email = "someone@example.com"
id = 9999999
response = client.purchase(subscriber_email, id)

if response.success?
  puts response.body["purchases"]
end
```

> The response looks like this:

```json
# The purchases property is an array of one purchase object.
{
  "links": { ... },
  "purchases": [{ ... }]
}
```

### HTTP Endpoint

`GET /:account_id/subscribers/:id_or_email/purchases/:purchase_id`

### Arguments

None.
